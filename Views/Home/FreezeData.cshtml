@using System.Data;
@{
    ViewData["Title"] = "FreezeData";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<form id="frmFreezeData" method="post">
    @{
        if (ViewBag.freezeSuccess == "success")
        {
            <script>
                alert("Data Freezed Succesfully....");
            </script>
        }
        if (ViewBag.freezeSuccess == "failed")
        {
            <script>
                alert("Invalid Password! Freeze Operation Failed........");
            </script>
        }
        if (ViewBag.unfreezeSuccess == "success")
        {
            <script>
                alert("Data Unfreezed Succesfully....");
            </script>
        }
        if (ViewBag.unfreezeSuccess == "failed")
        {
            <script>
                alert("Invalid Password! Unfreeze Operation Failed........");
            </script>
        }
        DataSet freezeItemList = ViewBag.freezeItemList;

    }
    <div class="container">
        <h2 class="pageheading">Freeze/Unfreeze Data</h2>
        <div class="row">
            <div class="col-sm-6">
                <label for="ddwnFreezeItem" class="form-label">Freeze Item</label>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="ModalFreezePassword" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Password for Freezing Data</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Password<input type="password" id="txtFreezePassword" name="txtFreezePassword" style="margin-left:10px;" /></p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger" asp-action="FreezeItem">Freeze</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="ModalUnfreezePassword" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Password for Unfreezing Data</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Password<input tabindex="1" type="password" id="txtUnfreezePassword" name="txtUnfreezePassword" style="margin-left:10px;" /></p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger" asp-action="UnfreezeItem">Unfreeze</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                @{
                    List<SelectListItem> items = new List<SelectListItem>();
                    foreach (DataRow row in freezeItemList.Tables[0].Rows)
                    {
                        SelectListItem s = new SelectListItem();
                        s.Text = row["FREEZE_ITEM"].ToString();
                        s.Value = row["F_ID"].ToString();
                        s.Selected = row["F_ID"].ToString() == (string)ViewBag.freezeItem ? true : false;
                        items.Add(s);
                    }
                }
                <select id="ddwnFreezeItem" name="ddwnFreezeItem" class="form-select" asp-items="@items" onchange="document.getElementById('frmFreezeData').submit();"></select>
            </div>
        </div>
        <div class="row" style="margin-top:10px;">
            <div class="col-sm-6">
                <div class="row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-4">
                        @{
                            bool freezed = false;
                            bool itemCreated = false;

                            if (Context.Request.Method == "POST")
                            {
                                foreach (DataRow row in freezeItemList.Tables[0].Rows)
                                {
                                    if (row["F_ID"].ToString() == Context.Request.Form["ddwnFreezeItem"].ToString() && (bool)row["FREEZED"])
                                    {
                                        <input type="button" class="btn btn-info form-control" value="Unfreeze Data" id="btnFreeze" data-bs-toggle="modal" data-bs-target="#ModalUnfreezePassword" />
                                        itemCreated = true;
                                        break;
                                    }
                                }
                            }
                            else
                            {
                                if ((bool)freezeItemList.Tables[0].Rows[0][2])
                                {
                                    freezed = true;
                                    <input type="button" class="btn btn-info form-control" value="Unfreeze Data" id="btnFreeze" data-bs-toggle="modal" data-bs-target="#ModalUnfreezePassword" />
                                    itemCreated = true;
                                }
                            }
                            if (!itemCreated)
                            {
                                <input type="button" class="btn btn-danger form-control" value="Freeze Data" id="btnFreeze" data-bs-toggle="modal" data-bs-target="#ModalFreezePassword" />
                            }
                        }
                    </div>
                    <div class="col-sm-4"></div>
                </div>
            </div>
        </div>
    </div>
</form>


